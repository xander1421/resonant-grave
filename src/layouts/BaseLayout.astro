---
export interface Props {
  title: string;
  description?: string;
}

const { title, description = "A dark science fiction saga where consciousness is currency and harmony has a price." } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | The Resonant Grave</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="scanlines"></div>
    <div class="noise"></div>
    <div class="neural-network"></div>
    <div class="hologram-grid"></div>
    <div class="glitch-overlay"></div>
    <header>
      <nav>
        <a href="/" class="logo">
          <span class="glitch" data-text="RESONANT">RESONANT</span>
          <span class="subtitle">GRAVE</span>
        </a>
        <div class="nav-links">
          <a href="/chapters">CHAPTERS</a>
        </div>
      </nav>
    </header>
    <main>
      <slot />
    </main>
    <footer>
      <p>&copy; 2024 The Resonant Grave</p>
      <p class="frequency">Frequency: <span id="freq">42.7</span> Hz</p>
    </footer>
  </body>
</html>

<style is:global>
  :root {
    --color-primary: #00ffcc;
    --color-secondary: #ff006e;
    --color-bg: #0a0a0a;
    --color-surface: #121212;
    --color-text: #e0e0e0;
    --color-text-dim: #808080;
    --color-accent: #ffb700;
  }
  
  /* Global background gradients */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background:
      radial-gradient(ellipse at center, rgba(0, 255, 204, 0.05) 0%, transparent 70%),
      radial-gradient(circle at 20% 80%, rgba(255, 0, 110, 0.05) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(255, 183, 0, 0.03) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    background-color: var(--color-bg);
    color: var(--color-text);
    font-family: 'Share Tech Mono', monospace;
    line-height: 1.6;
    min-height: 100%;
  }

  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }

  /* Force hardware acceleration and 60fps */
  .neural-network,
  .hologram-grid,
  .scanlines,
  .noise,
  .glitch-overlay {
    -webkit-backface-visibility: hidden;
    -webkit-perspective: 1000;
  }

  /* Cyber effects */
  .scanlines {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    background: repeating-linear-gradient(
      0deg,
      rgba(0, 0, 0, 0.15),
      rgba(0, 0, 0, 0.15) 1px,
      transparent 1px,
      transparent 2px
    );
    z-index: 1000;
  }

  .noise {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    opacity: 0.02;
    z-index: 999;
    background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj4KICA8ZmlsdGVyIGlkPSJub2lzZSI+CiAgICA8ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iMC45IiBudW1PY3RhdmVzPSI0IiAvPgogIDwvZmlsdGVyPgogIDxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbHRlcj0idXJsKCNub2lzZSkiIG9wYWNpdHk9IjEiLz4KPC9zdmc+');
  }

  /* Header */
  header {
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-primary);
    box-shadow: 0 0 20px rgba(0, 255, 204, 0.3);
    position: relative;
    z-index: 100;
  }

  nav {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1.5rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .logo {
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: var(--color-primary);
    font-family: 'Orbitron', monospace;
    line-height: 1;
  }

  .logo .glitch {
    font-size: 2rem;
    font-weight: 900;
    letter-spacing: 0.1em;
    position: relative;
  }

  .subtitle {
    font-size: 1rem;
    font-weight: 400;
    color: var(--color-secondary);
    letter-spacing: 0.3em;
    margin-top: -0.2rem;
  }

  /* Enhanced Glitch effect */
  .glitch {
    position: relative;
    color: var(--color-primary);
    text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
    animation: text-flicker 15s infinite linear;
  }

  @keyframes text-flicker {
    0%, 100% {
      opacity: 1;
    }
    88% {
      opacity: 1;
    }
    88.02% {
      opacity: 0.8;
    }
    88.04% {
      opacity: 0.8;
    }
    88.06% {
      opacity: 1;
    }
    88.08% {
      opacity: 0.8;
    }
    88.1% {
      opacity: 1;
    }
  }

  .glitch::before,
  .glitch::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .glitch::before {
    color: var(--color-secondary);
    z-index: -1;
    animation: glitch-1 2.5s infinite steps(60);
  }

  .glitch::after {
    color: var(--color-accent);
    z-index: -2;
    animation: glitch-2 2.5s infinite steps(60);
  }

  @keyframes glitch-1 {
    0%, 100% {
      clip-path: inset(0 0 0 0);
      transform: translate(0);
    }
    20% {
      clip-path: inset(40% 0 60% 0);
      transform: translate(-3px, 0);
    }
    40% {
      clip-path: inset(20% 0 30% 0);
      transform: translate(3px, 0);
    }
    60% {
      clip-path: inset(70% 0 10% 0);
      transform: translate(0, 2px);
    }
    80% {
      clip-path: inset(10% 0 85% 0);
      transform: translate(0, -2px);
    }
  }

  @keyframes glitch-2 {
    0%, 100% {
      clip-path: inset(0 0 0 0);
      transform: translate(0);
    }
    15% {
      clip-path: inset(10% 0 85% 0);
      transform: translate(2px, 0);
    }
    30% {
      clip-path: inset(70% 0 30% 0);
      transform: translate(-2px, 0);
    }
    45% {
      clip-path: inset(40% 0 60% 0);
      transform: translate(0, -1px);
    }
    65% {
      clip-path: inset(85% 0 10% 0);
      transform: translate(0, 1px);
    }
    85% {
      clip-path: inset(25% 0 75% 0);
      transform: translate(1px, 0);
    }
  }


  /* Glitch Overlay */
  .glitch-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1000;
    opacity: 0;
    background: linear-gradient(
      transparent 0%,
      rgba(0, 255, 204, 0.03) 50%,
      transparent 100%
    );
    animation: glitch-overlay 20s infinite steps(60);
  }

  @keyframes glitch-overlay {
    0%, 100% {
      opacity: 0;
    }
    92% {
      opacity: 0;
    }
    92.5% {
      opacity: 1;
      transform: translateX(5px);
    }
    93% {
      opacity: 0;
      transform: translateX(-5px);
    }
  }

  /* Neural Network Background - Global */
  .neural-network {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    opacity: 0.1;
    background-image:
      linear-gradient(rgba(0, 255, 204, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 255, 204, 0.1) 1px, transparent 1px);
    background-size: 50px 50px;
    animation: neural-pulse 20s steps(60) infinite;
    pointer-events: none;
    z-index: 1;
  }

  /* Fix for high refresh rate displays (90Hz, 120Hz) */
  @media (max-width: 768px) {
    .neural-network,
    .hologram-grid,
    .glitch-overlay {
      animation-play-state: paused;
      animation: none !important;
      opacity: 0.05;
    }

    .glitch::before,
    .glitch::after {
      animation-play-state: paused;
    }
  }

  @keyframes neural-pulse {
    0%, 100% {
      opacity: 0.1;
    }
    50% {
      opacity: 0.12;
    }
  }

  /* Holographic Grid Effect - Global */
  .hologram-grid {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: 
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 255, 204, 0.03) 2px,
        rgba(0, 255, 204, 0.03) 4px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 2px,
        rgba(255, 0, 110, 0.03) 2px,
        rgba(255, 0, 110, 0.03) 4px
      );
    animation: grid-shift 10s steps(60) infinite;
    pointer-events: none;
    z-index: 2;
  }

  @keyframes grid-shift {
    0% {
      transform: translate(0, 0);
    }
    100% {
      transform: translate(4px, 4px);
    }
  }

  .nav-links {
    display: flex;
    gap: 2rem;
  }

  .nav-links a {
    color: var(--color-text-dim);
    text-decoration: none;
    font-size: 0.9rem;
    letter-spacing: 0.1em;
    transition: all 0.3s ease;
    position: relative;
  }

  .nav-links a:hover {
    color: var(--color-primary);
    text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
  }

  .nav-links a::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 1px;
    background: var(--color-primary);
    transition: width 0.3s ease;
  }

  .nav-links a:hover::after {
    width: 100%;
  }

  /* Main content */
  main {
    flex: 1;
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
    padding: 3rem 2rem;
  }

  /* Footer */
  footer {
    background: var(--color-surface);
    border-top: 1px solid var(--color-primary);
    padding: 2rem;
    text-align: center;
    color: var(--color-text-dim);
    font-size: 0.9rem;
  }

  .frequency {
    margin-top: 0.5rem;
    color: var(--color-primary);
  }

  #freq {
    animation: flicker 3s infinite steps(60);
  }

  @keyframes flicker {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.8;
    }
    75% {
      opacity: 0.9;
    }
  }

  /* Typography */
  h1, h2, h3, h4, h5, h6 {
    font-family: 'Orbitron', monospace;
    color: var(--color-primary);
    line-height: 1.2;
    margin-bottom: 1rem;
  }

  h1 {
    font-size: 3rem;
    font-weight: 900;
  }

  h2 {
    font-size: 2rem;
    font-weight: 700;
  }

  h3 {
    font-size: 1.5rem;
    font-weight: 700;
  }

  p {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    line-height: 1.8;
  }

  a {
    color: var(--color-primary);
    transition: all 0.3s ease;
  }

  a:hover {
    color: var(--color-accent);
    text-shadow: 0 0 5px currentColor;
  }

  /* Blockquotes */
  blockquote {
    border-left: 3px solid var(--color-secondary);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-text-dim);
    background: linear-gradient(90deg, rgba(255, 0, 110, 0.1) 0%, transparent 100%);
    padding: 1rem 1.5rem;
  }

  /* Code blocks */
  pre {
    background: var(--color-surface);
    border: 1px solid rgba(0, 255, 204, 0.2);
    padding: 1rem;
    overflow-x: auto;
    margin: 1rem 0;
    border-radius: 4px;
  }

  code {
    font-family: 'Share Tech Mono', monospace;
    color: var(--color-accent);
  }

  /* Responsive */
  @media (max-width: 768px) {
    h1 {
      font-size: 2rem;
    }
    h2 {
      font-size: 1.5rem;
    }
    .nav-links {
      gap: 1rem;
    }
    main {
      padding: 2rem 1rem;
    }
  }
</style>

<script>
  // Frequency counter animation
  const freq = document.getElementById('freq');
  if (freq) {
    setInterval(() => {
      const newFreq = (40 + Math.random() * 5).toFixed(1);
      freq.textContent = newFreq;
    }, 2000);
  }


  // Glitch text on random intervals
  setInterval(() => {
    const glitchElements = document.querySelectorAll('.glitch');
    glitchElements.forEach(el => {
      if (Math.random() > 0.95) {
        el.style.transform = `translate(${Math.random() * 4 - 2}px, ${Math.random() * 2 - 1}px)`;
        setTimeout(() => {
          el.style.transform = 'translate(0, 0)';
        }, 50);
      }
    });
  }, 100);

  // Random system messages
  const messages = [
    'NEURAL_LINK_ESTABLISHED',
    'CONSCIOUSNESS_SYNC_47%',
    'MEMORY_FRAGMENTATION_DETECTED',
    'RESONANCE_FIELD_UNSTABLE',
    'QUANTUM_ENTANGLEMENT_ACTIVE',
    'GHOST_PROTOCOL_ENGAGED',
    'REALITY_MATRIX_LOADING',
    'SYNAPTIC_OVERFLOW_WARNING'
  ];

  setInterval(() => {
    const corruption = document.querySelector('.data-corruption');
    if (corruption && Math.random() > 0.7) {
      const spans = corruption.querySelectorAll('span');
      const randomSpan = spans[Math.floor(Math.random() * spans.length)];
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      randomSpan.textContent = randomMessage;
    }
  }, 3000);

  // Konami Code easter egg
  const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
  let konamiIndex = 0;

  document.addEventListener('keydown', (e) => {
    const key = e.key.toLowerCase();

    if (key === konamiCode[konamiIndex] || e.key === konamiCode[konamiIndex]) {
      konamiIndex++;

      if (konamiIndex === konamiCode.length) {
        // Success! Flash effect and redirect
        const body = document.body;
        body.style.transition = 'opacity 0.2s';
        body.style.opacity = '0.3';

        setTimeout(() => {
          body.style.opacity = '1';
        }, 100);

        setTimeout(() => {
          body.style.opacity = '0.3';
        }, 200);

        setTimeout(() => {
          body.style.opacity = '1';
          window.location.href = '/neural-link';
        }, 300);

        konamiIndex = 0;
      }
    } else {
      konamiIndex = 0;
    }
  });
</script>